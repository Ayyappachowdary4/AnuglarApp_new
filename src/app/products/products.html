<div class="container mt-4">
  <h2 class="text-center">Products CRUD App</h2>

  <!-- Loading -->
  @if (isLoading) {
    <div class="text-center">
      <img src="https://upload.wikimedia.org/wikipedia/commons/b/b1/Loading_icon.gif" alt="Loading...">
    </div>
  } @else {
    <!-- Product Form -->
    <form (ngSubmit)="saveProduct()" #formRef="ngForm" class="mb-4">
      <input type="text" [(ngModel)]="productForm.title" name="title" placeholder="Title" class="form-control mb-2" required>
      <input type="text" [(ngModel)]="productForm.category" name="category" placeholder="Category" class="form-control mb-2" required>
      <input type="number" [(ngModel)]="productForm.price" name="price" placeholder="Price" class="form-control mb-2" required>
      <input type="text" [(ngModel)]="productForm.image" name="image" placeholder="Image URL" class="form-control mb-2">

      <button type="submit" class="btn btn-success">{{ isEditMode ? 'Update' : 'Add' }} Product</button>
      <button type="button" class="btn btn-secondary ms-2" (click)="resetForm()">Reset</button>
    </form>

    <!-- Products Table -->
    @if (products.length > 0) {
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>ID</th><th>Title</th><th>Category</th><th>Price</th><th>Image</th><th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (product of products; track product.id) {
            <tr>
              <td>{{ product.id }}</td>
              <td>{{ product.title }}</td>
              <td>{{ product.category }}</td>
              <td>${{ product.price }}</td>
              <td><img [src]="product.image" [alt]="product.title" height="50"></td>
              <td>
                <button class="btn btn-primary btn-sm" (click)="editProduct(product)">Edit</button>
                <button class="btn btn-danger btn-sm ms-2" (click)="deleteProduct(product.id!)">Delete</button>
                <button class="btn btn-info btn-sm ms-2" (click)="viewDetails(product)">Details</button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    } @else {
      <p class="text-center text-muted">No products available.</p>
    }
  }
</div>

<!-- Details Modal -->
@if (selectedProduct) {
  <div class="modal fade show d-block" tabindex="-1" style="background: rgba(0,0,0,0.5);">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{selectedProduct.title}}</h5>
          <button type="button" class="btn-close" (click)="closeDetails()"></button>
        </div>
        <div class="modal-body text-center">
          <img [src]="selectedProduct.image" [alt]="selectedProduct.title" class="img-fluid mb-2" height="200">
          <p><strong>Category:</strong> {{selectedProduct.category}}</p>
          <p><strong>Price:</strong> ${{selectedProduct.price}}</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeDetails()">Close</button>
        </div>
      </div>
    </div>
  </div>
}
